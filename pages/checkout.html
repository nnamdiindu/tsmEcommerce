<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout – TSM Cosmetics</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <section class="max-w-5xl mx-auto p-6">
      <!-- Back to Shop Button -->
      <div class="mb-6">
        <a
          href="/pages/cart.html"
          class="inline-flex items-center text-purple-700 hover:text-purple-900 font-medium"
        >
          ← Back to Cart
        </a>
      </div>

      <h2 class="text-2xl font-bold mb-6">Checkout</h2>

      <form id="checkout-form" class="grid lg:grid-cols-2 gap-6">
        <!-- Shipping Details -->
        <div class="bg-[#580F41] p-4 rounded shadow text-white">
          <h3 class="text-lg font-semibold mb-4">Shipping Information</h3>
          <div class="space-y-4">
            <input
              type="text"
              placeholder="Full Name"
              name="name"
              class="w-full px-4 py-2 border rounded"
              required
            />
            <input
              type="email"
              placeholder="Email"
              name="email"
              class="w-full px-4 py-2 border rounded"
              required
            />
            <input
              type="text"
              placeholder="Phone Number"
              name="phone"
              class="w-full px-4 py-2 border rounded"
              required
            />
            <textarea
              placeholder="Delivery Address"
              name="address"
              class="w-full px-4 py-2 border rounded"
              required
            ></textarea>

            <!-- Delivery Option -->
            <select
              id="delivery-option"
              class="w-full px-4 py-2 border rounded text-[#580F41]"
              required
            >
              <option value="1500">Standard Delivery – ₦1,500</option>
              <option value="3000">Express Delivery – ₦3,000</option>
            </select>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="bg-[#C8A2C8] p-4 rounded shadow">
          <h3 class="text-lg font-semibold mb-4">Order Summary</h3>
          <div class="space-y-2 mb-4" id="order-list"></div>

          <div class="flex justify-between">
            <span>Subtotal:</span>
            <span>₦<span id="subtotal">0</span></span>
          </div>
          <div class="flex justify-between">
            <span>Delivery Fee:</span>
            <span>₦<span id="delivery">1500</span></span>
          </div>
          <hr class="my-2" />
          <div class="flex justify-between font-bold text-lg">
            <span>Total:</span>
            <span>₦<span id="total">0</span></span>
          </div>

          <button
            type="submit"
            class="w-full mt-4 bg-[#580F41] text-white px-4 py-2 rounded hover:text-[#C8A2B8]"
          >
            Place Order
          </button>
        </div>
      </form>
    </section>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed bottom-4 right-4 bg-black text-white px-4 py-2 rounded shadow hidden z-50"
    ></div>

    <script>
      const deliverySelect = document.getElementById("delivery-option");
      const subtotalEl = document.getElementById("subtotal");
      const deliveryEl = document.getElementById("delivery");
      const totalEl = document.getElementById("total");
      const orderList = document.getElementById("order-list");
      const cart = JSON.parse(localStorage.getItem("cart")) || [];

      const products = {
        "Lip Gloss": { price: 3000 },
        Foundation: { price: 7000 },
        Eyeliner: { price: 2500 },
      };

      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.remove("hidden");
        setTimeout(() => toast.classList.add("hidden"), 3000);
      }

      function updateTotals() {
        let subtotal = 0;
        orderList.innerHTML = "";

        cart.forEach((item) => {
          const price = products[item.name].price;
          const itemTotal = price * item.quantity;
          subtotal += itemTotal;

          orderList.innerHTML += `
            <div class="flex justify-between text-sm">
              <span>${item.quantity} × ${item.name}</span>
              <span>₦${itemTotal}</span>
            </div>
          `;
        });

        const deliveryFee = parseInt(deliverySelect.value);
        subtotalEl.textContent = subtotal;
        deliveryEl.textContent = deliveryFee;
        totalEl.textContent = subtotal + deliveryFee;
      }

      deliverySelect.addEventListener("change", updateTotals);
      window.onload = () => {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) {
          showToast("You must be logged in to checkout.");
          // You can uncomment the redirect below when your login system is ready
          // window.location.href = "/pages/auth.html";
        }

        if (!cart.length) {
          showToast("Your cart is empty.");
          window.location.href = "/index.html";
        }

        updateTotals();
      };

      document
        .getElementById("checkout-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const fields = this.querySelectorAll("input, textarea, select");
          for (const field of fields) {
            if (!field.value.trim()) {
              showToast("Please fill out all fields.");
              return;
            }
          }

          showToast("✅ Order placed successfully!");
          localStorage.removeItem("cart");
          setTimeout(() => {
            window.location.href = "/pages/index.html";
          }, 2000);
        });
    </script>
  </body>
</html>
